sudo: required
language: java
jdk: oraclejdk8
 
services:
- docker
 
env:
  global:
  - secure: "jXIBkLExEbXqqnWeKaTdNe4HhR7Tx7+aExA7vf36RZsXnXDgnJY3kKY9dJuVbzusYbJ3UcgbOkSOh7aul7Bz0zJZbbqW429ay273PNSI/VGq4Vm9dGsS2z2VTArG+0y0qf+12as0nBd7MTJuq/42g/rrcl4smYJCdhF1KHHmyznrPzVuluc+bFhiElWiMetytt/GXU7po8Bsd5GrIzbYGUvnSs1FEJLnoybR1OhCKb25ZKy4h2Dd3Vs/UFSv8K9R7VygjyfPLDacdE0bTaRcvfi6dCEi3swxLNl2uzJQp13tjIx9xWGDgz9rV+AljsNF0Thbk+bxmGTwq9dm3wuo5+LgX4TcSpuGhZb0hmdP8MhOjCQZZJVt5hIGD0ZMi+k4kR8sBqf9hVNgThKGh4ouEtLLZ3ySKJEXnQ0HT+FSSWEgHKkTYsxXt77TLwOT18GucK/VZPiq3D42oZSu029QMORwcNWpCn1B9zX/cTv+c1DkS88ye2oAA9NWRjAuVUAs02/3yVte4H1gkZrByuJIAfRmmeGbX8YnUxqT2HoXZwtHn8vU5u2knnLru9ojLv6k7ZgdsRHfdsDuoXkgRMdJNfxBYuyGuW8CB5pliMQARJckOkThMOAkUfi2bnqukLeGxzbIuNlQ8Jok9HcAGe5wrW4C5BU94XpHQtke4RR+sXA="
  - secure: "BR/OZZf0AWkeOLLR0KgDCvfCdGnZYnl8qFjHOrUYLfeVsr7sOVBsoAJcbchteb1+afcadH8XLYDyqSwJJqkx5idUj3qcFKXvTkYuOpIxuPv55Xj0Y77duUXrPVCjazxHpDBUSz0gUN2OY8t6VtFcxCnbDI0piatqQmzb3FcggfZP3c0EwxZQj9IDOttqEAAQOovnk1KIm8c1TBAM27f+c8n6biit2zfBZiQN4Q1StMa2ph7XnXl6hfjkdnellKeiRKuP39eP5vXjfrsAp3F2atBfl3rAFXxh8rNT3jmaOxyBwG1nJIvufLS0oDVnKsU11hIWuoEmDGVh8gDOxPNlTwq95EyHt8cDrhA3XWxwELN/rvq8xhdLfXyQo5COb45uHOlg34EOUGnWkgB3nlIbmN4oSf4exw5VFubymr2zfVF5KteuH/T/06C2oc5XLc0oK7mzZNvwYaFYygcL0Gs51Qxdxzp85koeQ+twHIpMWzQtOheCZIzRrEpqrKp7Wz9VxSPYlkVDARH93iNYI10zlR+9WPv8UNfDWOCQtVbpV/wzrkbHRA75mA104rWvRFSy/levGwGu0L8dQZ/qaV7OJvmHNygZl+AKgXJ5/NdUP9B2VAxdQaSx2pNVbVzSHJqVlin123NlyUWnzxlkIqMceodsW9tOH+592Md+eU3MSS8="
  - secure: "xyBDF7u6kS9kCHOVEc+3Gumcvi7f/4YXg+XuqKYj9VZnPrFH+gPBd9+VSFii//DOnZTnfnWnqC/9E9ZBOcMvQf4SMeCfKOg9tr27GcIgqJ1QNurMfPkzMiThyknVz2SkmpHZTaxlKX05ZeUzE7dG6lhJms8mmaIIrqISFJIvq0W+Aq9QkMT/zD1aP0nLnlr7wRtAKhVxHtU1Z3VK5GXjvXBlkGnNQg2hnmfDsjSPARBcYEbS+GTwUF2K7teLi20BknxOuOULNd7eHuj86YBks0LyUV8qQYTyOEpC1VlgCev9tIna3Ky8aZ5PVndIBqP6Q9o6ZqmRFiqybHW+ZevqKPN8Z28GhiRUXB60Wn3yUOKN4q4Md831N0ZSKXJ6AWgX3RBiBzf4dlz6W0Dr0uMhDUpMI7HQNZjjBSGnupB4gIYuy+I9lM8Vx0ENShAk5eAxnsEhHYeDREPPV3YFkFhKZ3qJHuUy0afxSmfIpSlagFSnK01evwJ+wNMGJFbYqa7ai52UteipBw8WsbWW1fX9nSE/lBhEfoTvOig5wKsMXRUdFQyRd/4dZof+uDw7i3fbTt3e2F/uicGnTgFW2OFjdZWmoOCv56QhFaDeF6yHLVZQ1c9v1HKc4Z3J2PFIWkhzaVRiTHDhQhmhwYQyE6bW/Xk4UBlCyLeqLfvxobufb7A="
  - secure: "cwNXxkjBqiEqIQQq5TYqzxq4DzlqLj1pUjVzDEdpYwtH5MkeTmROvFX+XvOl7Ax/S7n1UZW74FAW3/S/DrY4eDARqHjB0GxQdAzmftupxE1FLUrrFVIW4Miw2mhB1famD83LBlLtBS2O49tpoZUovkWhKBilW0qTTAS7th3hvFU5muBycBvYEqfVA1MzrdoJlf5W2n4KbrxDAdPyhKmq/yE9B9lHltDvAipKcZfokTJP3hMNU21FBbA1oeMoJ/KB2AEPOCl+Lws6awa4tQPZVMBk3l9aeWdCDhXtQqaT3SR/4wiQ6VDY9BVgotY3HnPhNXXEcE2rx3WPgd0F2cU3UxXnHSF+H+hrhCFGLkCUfM7fodHz07BHTRwbifxSGUek6f3cfwfch62KMXphoFVni2DQ5gx3RNDBAyNsNUtTxKC/RF3GPrDcVvhXg4of3cxQ4o7OAUC6zs6FaHr+yNY0dqAdF8JMlCF+0H1aNmGrHh13f+ej8BPslbolWI+x6tF5MUXubPNmj6M0y+B5j/g0XOProYIWDYIrFPUY5Hg1dTdkx5oYjELPavVoTmE83MvOJ2xMLQZfhEGTh3ubgKlOYdlrmCSRqH6jMTh/easXtbpsycWeweGJoKbiFGoiZxOIc8L/AZ8b3hw/KzeEnAUKpyQ/oQkWVJJbHAC5lP/Jui8="
  - COMMIT=${TRAVIS_COMMIT::7}
 
addons:
  sonarcloud:
    organization: "dolphin"
    token:
      secure: ${SONAR_TOKEN}
 
script:
- ./mvnw clean install -B
- ./mvnw clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar
 
after_success:
- docker login -u ${DOCKER_USER} -p ${DOCKER_PASS}
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH&amp;amp;amp;amp;amp;amp;amp;lt;span data-mce-type="bookmark" style="display: inline-block; width: 0px; overflow: hidden; line-height: 0;" class="mce_SELRES_start"&amp;amp;amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;amp;amp;lt;/span&amp;amp;amp;amp;amp;amp;amp;gt;; fi`
- export IMAGE_NAME=edium/edium-service-user
- docker build -t ${IMAGE_NAME}:${COMMIT} .
- docker tag ${IMAGE_NAME}:${COMMIT} ${IMAGE_NAME}:${TAG}
- docker push ${IMAGE_NAME}
 
deploy:
  provider: heroku
  api_key: ${HEROKU_API_KEY}
  app: edium-service-user